@model SystemeNote.ViewModels.AcademicRecordViewModel

@{
    ViewData["Title"] = $"Relevé de notes de {Model.Etudiant.Prenom} {Model.Etudiant.Nom}";
}

<h1>@ViewData["Title"]</h1>

<div>
    <h4>Informations sur l'étudiant</h4>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Matricule</dt>
        <dd class="col-sm-10">@Model.Etudiant.Matricule</dd>

        <dt class="col-sm-2">Nom complet</dt>
        <dd class="col-sm-10">@Model.Etudiant.Prenom @Model.Etudiant.Nom</dd>

        <dt class="col-sm-2">Total des crédits obtenus</dt>
        <dd class="col-sm-10"><strong>@Model.TotalCreditsObtained</strong></dd>
    </dl>
</div>

<hr />

<h2>Parcours académique</h2>

@if (!Model.Semesters.Any())
{
    <div class="alert alert-warning" role="alert">
        Aucune note enregistrée pour cet étudiant.
    </div>
}

<div class="accordion" id="semestersAccordion">
    @foreach (var semester in Model.Semesters)
    {
        var statusClass = semester.Status == "Validé" ? "text-success" : "text-danger";
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-@semester.SemesterName.Replace(" ", "")">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapse-@semester.SemesterName.Replace(" ", "")" aria-expanded="false"
                    aria-controls="collapse-@semester.SemesterName.Replace(" ", "")">
                    <div class="w-100 d-flex justify-content-between">
                        <strong>@semester.SemesterName</strong>
                        <span>Crédits: @semester.CreditsObtained / @semester.TotalCredits</span>
                        <strong class="@statusClass">@semester.Status</strong>
                    </div>
                </button>
            </h2>
            <div id="collapse-@semester.SemesterName.Replace(" ", "")" class="accordion-collapse collapse"
                aria-labelledby="heading-@semester.SemesterName.Replace(" ", "")" data-bs-parent="#semestersAccordion">
                <div class="accordion-body">
                    @foreach (var ue in semester.UEs)
                    {
                        var ueStatusClass = ue.UeAverage >= 10 ? "text-success" : "text-danger";
                        <h5>@ue.UeCode - (@ue.Credits crédits)</h5>
                        <p>Moyenne UE: <strong class="@ueStatusClass">@ue.UeAverage.ToString("F2")</strong></p>
                        <table class="table table-sm table-striped">
                            <thead class="table-light">
                                <tr>
                                    <th>Matière</th>
                                    <th>Note</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var matiere in ue.Matieres)
                                {
                                    <tr>
                                        <td>@matiere.MatiereName</td>
                                        <td>@(matiere.Note.HasValue? matiere.Note.Value.ToString("F2") : "N/A")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                </div>
            </div>
        </div>
    }
</div>

<div class="mt-3">
    <a asp-action="Index" class="btn btn-secondary">Retour à la liste</a>
</div>